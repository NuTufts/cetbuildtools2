

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>CetTest &mdash; cetbuildtools2 0.5.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="cetbuildtools2 0.5.0 documentation" href="../index.html"/>
        <link rel="next" title="CetUPS" href="CetUPS.html"/>
        <link rel="prev" title="CetInstallDirs" href="CetInstallDirs.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> cetbuildtools2
          

          
          </a>

          
            
            
              <div class="version">
                0.5.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Using cetbuildtools2</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction to cetbuildtools2</a></li>
<li class="toctree-l1"><a class="reference internal" href="CetCMakeSettings.html">CetCMakeSettings</a></li>
<li class="toctree-l1"><a class="reference internal" href="CetCompilerSettings.html">CetCompilerSettings</a></li>
<li class="toctree-l1"><a class="reference internal" href="CetInstallDirs.html">CetInstallDirs</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">CetTest</a></li>
<li class="toctree-l1"><a class="reference internal" href="CetUPS.html">CetUPS</a></li>
<li class="toctree-l1"><a class="reference internal" href="CetCMakeUtilities.html">CetCMakeUtilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="CetUninstallTarget.html">CetUninstallTarget</a></li>
<li class="toctree-l1"><a class="reference internal" href="CetWriteCXXVersionAPI.html">CetWriteCXXVersionAPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="BasicPlugin.html">BasicPlugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="CetMake.html">CetMake</a></li>
</ul>
<p class="caption"><span class="caption-text">Additional Find Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../find-modules/FindCppUnit.html">FindCppUnit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../find-modules/FindSQLite.html">FindSQLite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../find-modules/FindTBB.html">FindTBB</a></li>
</ul>
<p class="caption"><span class="caption-text">Developing cetbuildtools2</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developers/cmakeguide.html">CMake Coding Conventions for cetbuildtools2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers/cmakedocs.html">Documenting CMake Modules and other Constructs</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">cetbuildtools2</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>CetTest</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/users/CetTest.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="cettest">
<h1>CetTest<a class="headerlink" href="#cettest" title="Permalink to this headline">¶</a></h1>
<div class="highlight-cmake"><div class="highlight"><pre><span></span><span class="nb">include</span><span class="p">(</span><span class="s">CetTest</span><span class="p">)</span>
</pre></div>
</div>
<p>Declare and define tests compatible with CET testing policies.</p>
<p>Include this module at the root of your project’s testing tree or
wherever you need to specify a test.</p>
<p>The following functions are provided to help in declaring tests and
defining their properties</p>
<dl class="command">
<dt id="command:cet_test">
<code class="descname">cet_test</code><a class="headerlink" href="#command:cet_test" title="Permalink to this definition">¶</a></dt>
<dd><div class="highlight-cmake"><div class="highlight"><pre><span></span><span class="nb">cet_test</span><span class="p">(</span><span class="s">&lt;target&gt;</span> <span class="s">[&lt;options&gt;]</span> <span class="s">[&lt;args&gt;]</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<p>Specify tests in a concise and transparent way (see also
<code class="docutils literal"><span class="pre">cet_test_env()</span></code> and <code class="docutils literal"><span class="pre">cet_test_assertion()</span></code>, below).</p>
<p>Options:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">HANDBUILT</span></code></dt>
<dd>Do not build the target – it will be provided. This option is
mutually exclusive with the PREBUILT option.</dd>
<dt><code class="docutils literal"><span class="pre">PREBUILT</span></code></dt>
<dd>Do not build the target – pick it up from the source dir (eg
scripts).  This option is mutually exclusive with the HANDBUILT
option and simply calls the cet_script() function with appropriate
options.</dd>
<dt><code class="docutils literal"><span class="pre">USE_BOOST_UNIT</span></code></dt>
<dd>This test uses the Boost Unit Test Framework.</dd>
<dt><code class="docutils literal"><span class="pre">USE_CATCH_MAIN</span></code></dt>
<dd><p class="first">This test will use the Catch test framework
(<a class="reference external" href="https://github.com/philsquared/Catch">https://github.com/philsquared/Catch</a>). The specified target will be
built from a precompiled main program to run tests described in the
files specified by SOURCES.</p>
<p class="last">N.B.: if you wish to use the ParseAndAddCatchTests() facility
contributed to the Catch system, you should specify NO_AUTO to avoid
generating a, “standard” test. Note also that you may have your own
test executables using Catch without using USE_CATCH_MAIN. However,
be aware that the compilation of a Catch main is quite expensive,
and any tests that <em>do</em> use this option will all share the same
compiled main.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">NO_AUTO</span></code></dt>
<dd>Do not add the target to the auto test list.</dd>
</dl>
<p>Arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">CONFIGURATIONS</span></code></dt>
<dd>Configurations (Debug, etc, etc) under which the test shall be executed.</dd>
<dt><code class="docutils literal"><span class="pre">DATAFILES</span></code></dt>
<dd>Input and/or references files to be copied to the test area in the
build tree for use by the test. If there is no path, or a relative
path, the file is assumed to be in or under
<code class="docutils literal"><span class="pre">CMAKE_CURRENT_SOURCE_DIR</span></code>.</dd>
<dt><code class="docutils literal"><span class="pre">DEPENDENCIES</span></code></dt>
<dd>List of top-level dependencies to consider for a PREBUILT
target. Top-level implies a target (not file) created with
ADD_EXECUTABLE, ADD_LIBRARY or ADD_CUSTOM_TARGET.</dd>
<dt><code class="docutils literal"><span class="pre">LIBRARIES</span></code></dt>
<dd>Extra libraries to link to the resulting target.</dd>
<dt><code class="docutils literal"><span class="pre">OPTIONAL_GROUPS</span></code></dt>
<dd>Assign this test to one or more named optional groups. If the CMake
list variable <code class="docutils literal"><span class="pre">CET_TEST_GROUPS</span></code> is set (e.g. with -D on the CMake
command line) and there is overlap between the two lists, execute
the test. The <code class="docutils literal"><span class="pre">CET_TEST_GROUPS</span></code> cache variable may additionally
contain the optional values ALL or NONE.</dd>
<dt><code class="docutils literal"><span class="pre">PARG_&lt;label&gt;</span> <span class="pre">&lt;opt&gt;[=]</span> <span class="pre">&lt;args&gt;+</span></code></dt>
<dd><p class="first">Specify a permuted argument (multiple permitted with different
&lt;label&gt;). This allows the creation of multiple tests with arguments
from a set of permutations.</p>
<p>Labels must be unique, valid CMake identifiers. Duplicated labels
will cause an error.</p>
<p>If multiple PARG_XXX arguments are specified, then they are combined
linearly, with shorter permutation lists being repeated cyclically.</p>
<p>If the ‘=’ is specified, then the argument lists for successive test
iterations will get &lt;opt&gt;=v1, &lt;opt&gt;=v2, etc., otherwise it will be
&lt;opt&gt; v1, &lt;opt&gt; v2, …</p>
<p>Target names will have _&lt;num&gt; appended, where num is zero-padded to
give the same number of digits for each target within the set.</p>
<p>Permuted arguments will be placed before any specifed TEST_ARGS in
the order the PARG_&lt;label&gt; arguments were specified to cet_test().</p>
<p class="last">There is no support for non-option argument toggling as yet, but
addition of such support should be straightforward should the use
case arise.</p>
</dd>
</dl>
<p><code class="docutils literal"><span class="pre">REF</span> <span class="pre">&lt;file&gt;</span></code></p>
<blockquote>
<div><p>The standard output of the test will be captured and compared against
the specified reference file. It is an error to specify this
argument and either the <code class="docutils literal"><span class="pre">PASS_REGULAR_EXPRESSION</span></code> or
<code class="docutils literal"><span class="pre">FAIL_REGULAR_EXPRESSION</span></code> test properties to the <code class="docutils literal"><span class="pre">TEST_PROPERTIES</span></code>
argument: success is the logical AND of the exit code from execution
of the test as originally specified, and the success of the
filtering and subsequent comparison of the output (and optionally,
the error stream). Optionally, a second element may be specified
representing a reference for the error stream; otherwise, standard
error will be ignored.</p>
<p>If <code class="docutils literal"><span class="pre">REF</span></code> is specified, then <code class="docutils literal"><span class="pre">OUTPUT_FILTERS</span></code> may also be specified
(<code class="docutils literal"><span class="pre">OUTPUT_FILTER</span></code> and optionally <code class="docutils literal"><span class="pre">OUTPUT_FILTER_ARGS</span></code> will be accepted in
the alternative for historical reasons). <code class="docutils literal"><span class="pre">OUTPUT_FILTER</span></code> must be a
program which expects input on STDIN and puts the filtered output on
STDOUT. <code class="docutils literal"><span class="pre">OUTPUT_FILTERS</span></code> should be a list of filters expecting input
on STDIN and putting output on STDOUT. If <code class="docutils literal"><span class="pre">DEFAULT</span></code> is specified as a
filter, it will be replaced at that point in the list of filters by
appropriate defaults. Examples:</p>
<blockquote>
<div><p>OUTPUT_FILTERS “filterA -x -y “arg with spaces”” filterB</p>
<p>OUTPUT_FILTERS filterA DEFAULT filterB</p>
</div></blockquote>
</div></blockquote>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">REQUIRED_FILES</span> <span class="pre">&lt;file&gt;+</span></code></dt>
<dd>These files are required to be present before the test will be
executed. If any are missing, <code class="docutils literal"><span class="pre">ctest</span></code> will record NOT RUN for this
test.</dd>
</dl>
<p><code class="docutils literal"><span class="pre">&lt;TYPE&gt;SAN_OPTIONS</span></code> (NOT IMPLEMENTED YET)</p>
<blockquote>
<div>Option representing the desired value of the corresponding sanitizer
control environment variable for the test.</div></blockquote>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">SCOPED</span></code></dt>
<dd>Test target (but not <code class="docutils literal"><span class="pre">PREBUILT</span></code> not <code class="docutils literal"><span class="pre">HANDBUILT</span></code> executable) names will
be scoped by project name (&lt;PROJECT_NAME&gt;:…)</dd>
<dt><code class="docutils literal"><span class="pre">SOURCE[S]</span> <span class="pre">&lt;file&gt;+</span></code></dt>
<dd>Sources to use to build the target (default is “${target}.cc”).</dd>
<dt><code class="docutils literal"><span class="pre">TEST_ARGS</span> <span class="pre">&lt;arg&gt;+</span></code></dt>
<dd>Any arguments to the test to be run.</dd>
<dt><code class="docutils literal"><span class="pre">TEST_EXEC</span> <span class="pre">&lt;program&gt;</span></code></dt>
<dd>The executable to run (if not the same as the test name). The <code class="docutils literal"><span class="pre">HANDBUILT</span></code> option must
be specified in conjunction with this option. It should be supplied
as a full path to the executable or cet_test will fall back to the <code class="docutils literal"><span class="pre">PATH</span></code>
environment to find it. Generator expressions may be used, e.g. <code class="docutils literal"><span class="pre">$&lt;TARGET_FILE:name&gt;</span></code>.</dd>
<dt><code class="docutils literal"><span class="pre">TEST_PROPERTIES</span> <span class="pre">&lt;PROPERTY</span> <span class="pre">value&gt;+</span></code></dt>
<dd>Properties to be added to the test. See documentation of the cmake
command, “set_tests_properties.”</dd>
</dl>
<p>Cache variables</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">CET_DEFINED_TEST_GROUPS</span></code></dt>
<dd>Any test group names CMake sees will be added to this list.</dd>
</dl>
<ul class="simple">
<li>The CMake properties <code class="docutils literal"><span class="pre">PASS_REGULAR_EXPRESSION</span></code> and
<code class="docutils literal"><span class="pre">FAIL_REGULAR_EXPRESSION</span></code> are incompatible with the <code class="docutils literal"><span class="pre">REF</span></code> option, but we
cannot check for them if you use CMake’s <code class="docutils literal"><span class="pre">add_tests_properties</span></code>
rather than <code class="docutils literal"><span class="pre">cet_test(CET_TEST_PROPERTIES</span> <span class="pre">...)</span></code>.</li>
<li>If you intend to set the property <code class="docutils literal"><span class="pre">SKIP_RETURN_CODE</span></code>, you should use
<code class="docutils literal"><span class="pre">CET_TEST_PROPERTIES</span></code> to set it rather than <code class="docutils literal"><span class="pre">add_tests_properties</span></code>, as
<code class="docutils literal"><span class="pre">cet_test</span></code> needs to take account of your preference.</li>
</ul>
<dl class="command">
<dt id="command:cet_test_env">
<code class="descname">cet_test_env</code><a class="headerlink" href="#command:cet_test_env" title="Permalink to this definition">¶</a></dt>
<dd><div class="highlight-cmake"><div class="highlight"><pre><span></span><span class="nb">cet_test_env</span><span class="p">(</span><span class="s">[CLEAR]</span> <span class="s">[&lt;env&gt;]</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<p>Configure environment in which all subsequently defined tests will run.
If <code class="docutils literal"><span class="pre">&lt;env&gt;</span></code> is set to a list of environment variables and values in the form <code class="docutils literal"><span class="pre">MYVAR=value</span></code>
those environment variables will be defined while running the test.</p>
<p>The set environment is propagated to all subsequent tests, including
subdirectories of the call location. The currently defined environment
can be reset using the <code class="docutils literal"><span class="pre">CLEAR</span></code> option, or by <code class="docutils literal"><span class="pre">include(CetTest)</span></code>.</p>
<p>If test-specific environment settings are required, the <code class="docutils literal"><span class="pre">TEST_PROPERTIES</span></code>
argument to <code class="docutils literal"><span class="pre">cet_test</span></code> should be preferred, using the CTest <code class="docutils literal"><span class="pre">ENVIRONMENT</span></code>
property. For example:</p>
<div class="highlight-cmake"><div class="highlight"><pre><span></span><span class="nb">cet_test</span><span class="p">(</span><span class="s">MyTest</span> <span class="s">TEST_PROPERTIES</span> <span class="s">ENVIRONMENT</span> <span class="s2">&quot;A=one;B=two&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that System Integrity Protection on macOS will
<a class="reference external" href="https://developer.apple.com/library/content/documentation/Security/Conceptual/System_Integrity_Protection_Guide/RuntimeProtections/RuntimeProtections.html">strip certain variables from the environment</a>
when the test is launched as a child process of a SIP-protected process.
In particular, <code class="docutils literal"><span class="pre">DYLD_LIBRARY_PATH</span></code> is stripped and this may affect the running
of tests that rely on this (such as plugins loaded at runtime).</p>
<p><code class="docutils literal"><span class="pre">cet_test</span></code> will cache and forward on to tests the setting of the dynamic loader path, if any, when
<code class="docutils literal"><span class="pre">cmake</span></code> is run for the first time on a project using it. This is to assist tests that use
external libraries that rely on the dynamic loader rather than <code class="docutils literal"><span class="pre">ld.so.conf</span></code> or
rpath to find their dependencies. CMake builds use rpath by default to locate
internal dependencies of a project, e.g. a project-built program <code class="docutils literal"><span class="pre">foo</span></code> that uses
a library <code class="docutils literal"><span class="pre">libfoo</span></code> also built by the project, so you do not need to set
or configure the dynamic loader path for tests of this case.</p>
<p>If your project has tests that load project libraries dynamically (i.e. <code class="docutils literal"><span class="pre">cetlib</span></code>
style plugins), then you will need to use <code class="docutils literal"><span class="pre">cet_test_env</span></code> to tell the tests
where the find these libraries. The canonical way to do this is:</p>
<div class="highlight-cmake"><div class="highlight"><pre><span></span><span class="nb">include</span><span class="p">(</span><span class="s">CetTest</span><span class="p">)</span>
<span class="nb">cet_test_env</span><span class="p">(</span><span class="s2">&quot;CETD_LIBRARY_PATH=$&lt;TARGET_FILE_DIR:fooplugin&gt;:$ENV{CETD_LIBRARY_PATH}&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Here <code class="docutils literal"><span class="pre">CETD_LIBRARY_PATH</span></code> is the internal, portable environment variable used by cetbuildtools2
to store the dynamic loader path to forward on to tests. It may be set like any path-style
variable. It is recommended to use a CMake generator expression to point to the location
of the project’s loadable targets as this guarantees use of the project libraries without clashing with
any system install in addition to being portable between Make/Ninja/Xcode/Visual Studio.</p>
<p>If the test program is a <code class="docutils literal"><span class="pre">bash</span></code> script rather than a binary executable, <cite>cet_test_env</cite>
may not be able to forward on the dynamic loader path correctly if a SIP-enabeld <code class="docutils literal"><span class="pre">bash</span></code>
is used. In this case, you should write the shbang and first lines of your script as</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
. cet_test_functions.sh
<span class="c1"># ... implementation follows ...</span>
</pre></div>
</div>
<p>Here, the <code class="docutils literal"><span class="pre">cet_test_functions.sh</span></code> script is sourced and will correctly forward the dynamic
loader environment for subsequent commands.</p>
<dl class="command">
<dt id="command:cet_test_assertion">
<code class="descname">cet_test_assertion</code><a class="headerlink" href="#command:cet_test_assertion" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>require assertion failure on given condition</p>
<p>Usage: cet_test_assertion(CONDITION TARGET…)</p>
<p>Notes:</p>
<ul class="simple">
<li>CONDITION should be a CMake regex which should have any escaped
items doubly-escaped due to being passed as a string argument
(e.g. “\(” for a literal open-parenthesis, “\.” for a literal
period).</li>
<li>TARGET…: the name(s) of the test target(s) as specified to
cet_test() or add_test(). At least one name must be supplied.</li>
</ul>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="CetUPS.html" class="btn btn-neutral float-right" title="CetUPS" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="CetInstallDirs.html" class="btn btn-neutral" title="CetInstallDirs" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Ben Morgan.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.5.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>